generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
    schemas  = ["auth", "content"]
}

//#region AUTH SCHEMA
model User {
    id        Int      @id @default(autoincrement())
    name      String
    email     String   @unique
    username  String   @unique
    hash      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    roles    Role[]    @relation("user_role")
    projects Project[]
    posts    Post[]

    @@map("users")
    @@schema("auth")
}

model Role {
    id          Int     @id @default(autoincrement())
    name        String  @unique
    description String? @db.VarChar(100)

    users User[] @relation("user_role")

    @@map("roles")
    @@schema("auth")
}

//#endregion

//#region CONTENT SCHEMA
model Project {
    id          Int      @id @default(autoincrement())
    title       String
    slug        String
    description String?
    repoUrl     String?
    demoUrl     String?
    techStack   String[] // e.g. ["NestJS", "React", "PostgreSQL"]
    featured    Boolean  @default(false)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user   User @relation(fields: [userId], references: [id])
    userId Int

    @@unique([slug, userId])
    @@map("projects")
    @@schema("content")
}

model Post {
    id        Int      @id @default(autoincrement())
    title     String
    slug      String
    content   String
    published Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    author   User @relation(fields: [authorId], references: [id])
    authorId Int

    @@unique([slug, authorId])
    @@map("posts")
    @@schema("content")
}

//#endregion
