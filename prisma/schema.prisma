datasource db {
    provider = "postgresql"
    schemas  = ["auth", "content"]
}

generator client {
    provider     = "prisma-client"
    output       = "../src/generated/prisma"
    moduleFormat = "cjs"
}

//#region AUTH SCHEMA
model User {
    id        Int      @id @default(autoincrement())
    firstName String   @map("first_name") @db.VarChar(100)
    lastName  String?  @map("last_name") @db.VarChar(100)
    email     String   @unique
    username  String   @unique
    hash      String
    isActive  Boolean  @default(true) @map("is_active")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    roles    Role[]    @relation("user_role")
    projects Project[]
    posts    Post[]

    @@map("users")
    @@schema("auth")
}

model Role {
    id          Int      @id @default(autoincrement())
    name        String   @unique
    description String?  @db.VarChar(100)
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")

    users User[] @relation("user_role")

    @@map("roles")
    @@schema("auth")
}
//#endregion

//#region CONTENT SCHEMA
model Project {
    id          Int      @id @default(autoincrement())
    title       String
    slug        String
    description String?
    repoUrl     String?  @map("repo_url")
    demoUrl     String?  @map("demo_url")
    techStack   String[] @default([]) @map("tech_stack")
    featured    Boolean  @default(false)
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")

    user   User @relation(fields: [userId], references: [id])
    userId Int  @map("user_id")

    @@unique([slug, userId])
    @@map("projects")
    @@schema("content")
}

model Post {
    id        Int      @id @default(autoincrement())
    title     String
    slug      String
    content   String
    published Boolean  @default(false)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    author   User @relation(fields: [authorId], references: [id])
    authorId Int  @map("author_id")

    @@unique([slug, authorId])
    @@map("posts")
    @@schema("content")
}

//#endregion
